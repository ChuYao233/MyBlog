---
interface Props {
	src: string;
	alt?: string;
	class?: string;
	style?: string;
	loading?: "lazy" | "eager";
}

const { src, alt = "", class: className, style, loading = "lazy" } = Astro.props;
---

<div class:list={["image-container relative", className]} style={style}>
	<!-- 加载动画 -->
	<div class="image-skeleton absolute inset-0 flex items-center justify-center bg-black/5 dark:bg-white/5">
		<div class="image-spinner">
			<svg class="animate-spin" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke="var(--primary)" fill="none"></circle>
				<path class="opacity-75" fill="currentColor" fill="var(--primary)" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
			</svg>
		</div>
	</div>
	
	<!-- 图片 -->
	<img
		src={src}
		alt={alt}
		loading={loading}
		class="image-content w-full h-full object-cover opacity-0 transition-opacity duration-300"
		onload="this.classList.add('opacity-100'); this.parentElement?.querySelector('.image-skeleton')?.classList.add('hidden');"
		onerror="this.classList.add('hidden'); this.parentElement?.querySelector('.image-error')?.classList.remove('hidden'); this.parentElement?.querySelector('.image-skeleton')?.classList.add('hidden');"
	/>
	
	<!-- 错误占位图 -->
	<div class="image-error hidden absolute inset-0 flex flex-col items-center justify-center bg-black/5 dark:bg-white/5 text-black/30 dark:text-white/30">
		<svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
		</svg>
		<span class="text-xs text-center px-2">图片加载失败</span>
	</div>
</div>

<style>
	.image-container {
		overflow: hidden;
	}
	
	.image-skeleton {
		z-index: 1;
	}
	
	.image-content {
		position: relative;
		z-index: 2;
	}
	
	.image-content.opacity-100 {
		opacity: 1;
	}
	
	.image-error {
		z-index: 3;
	}
	
	.image-spinner {
		animation: spin 1s linear infinite;
	}
	
	@keyframes spin {
		from {
			transform: rotate(0deg);
		}
		to {
			transform: rotate(360deg);
		}
	}
</style>

